<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTF Security Challenge - Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/header') %>

    <div class="container">
        <div class="dashboard-header">
            <h1>üèÜ CTF Security Challenge</h1>
            <div class="score-info">
                <span class="score">Score: <%= totalPoints %> points</span>
                <span class="progress"><%= foundFlags.length %>/8 challenges termin√©s</span>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="card leaderboard">
            <h2>üèÖ Classement</h2>
            <div class="leaderboard-table">
                <table>
                    <thead>
                        <tr>
                            <th>Rang</th>
                            <th>Utilisateur</th>
                            <th>Points</th>
                            <th>Challenges</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% leaderboard.forEach((user, index) => { %>
                            <tr class="<%= user.isCurrentUser ? 'current-user' : '' %>">
                                <td class="rank">
                                    <% if (index === 0) { %>
                                        ü•á
                                    <% } else if (index === 1) { %>
                                        ü•à
                                    <% } else if (index === 2) { %>
                                        ü•â
                                    <% } else { %>
                                        <%= index + 1 %>
                                    <% } %>
                                </td>
                                <td class="username">
                                    <%= user.username %>
                                    <% if (user.isCurrentUser) { %>
                                        <span class="badge">Vous</span>
                                    <% } %>
                                </td>
                                <td class="points"><%= user.totalPoints %> pts</td>
                                <td class="completed"><%= user.completedCount %>/8</td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Zone de validation des flags -->
        <div class="card flag-validation">
            <h2>üîë Validation des Flags</h2>
            <form action="/validate-flag" method="POST" class="flag-form">
                <input type="text" name="flag" placeholder="CTF{...}" required>
                <button type="submit">Valider Flag</button>
            </form>
            
            <% if (message) { %>
                <div class="message <%= message.type %>">
                    <%= message.text %>
                </div>
            <% } %>
        </div>

        <!-- Liste des challenges -->
        <div class="card challenges-list">
            <h2>üìã Challenges</h2>
            <p class="subtitle">Tous les challenges valent 100 points</p>
            
            <div class="challenges">
                <% challenges.forEach(challenge => { %>
                    <div class="challenge-item <%= challenge.status %>">
                        <div class="challenge-info">
                            <span class="status-icon">
                                <% if (challenge.status === 'completed') { %>
                                    ‚úÖ
                                <% } else if (challenge.status === 'in_progress') { %>
                                    ‚è≥
                                <% } else { %>
                                    ‚ùå
                                <% } %>
                            </span>
                            <div class="challenge-details">
                                <h3>Challenge <%= challenge.id %> - <%= challenge.name %></h3>
                                <span class="points">[<%= challenge.points %>pt]</span>
                            </div>
                        </div>
                        <a href="/challenge<%= challenge.id %>" class="btn-challenge">Acc√©der</a>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>
</body>
</html>
